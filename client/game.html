<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Space Game</title>
</head>
<body>
    <canvas id="canvas"></canvas>
</body>

<script src="https://cdn.socket.io/4.5.4/socket.io.min.js" integrity="sha384-/KNQL8Nu5gCHLqwqfQjA689Hhoqgi2S84SNUxC3roTe4EhJ9AfLkp8QiQcU8AMzI" crossorigin="anonymous"></script><script>
  const socket = io()
  
  const FPS = 60 //Frames Per Second
  var canv = document.getElementById("canvas")
  var ctx = canv.getContext('2d')
  canv.width = 1000
  canv.height = 1000

  document.addEventListener("keydown", keyDown)
  document.addEventListener("keyup", keyUp)

  function keyDown(e){
      switch(e.keyCode){
          case 37: 
            socket.emit('leftKeyDown')
              break
          case 38: 
            socket.emit('upKeyDown')
              break
          case 39: 
            socket.emit('rightKeyDown')
              break
      }
  }

  function keyUp(e) {
      switch(e.keyCode){
          case 37: 
            socket.emit('leftKeyUp')
              break
          case 38: 
            socket.emit('upKeyUp')
              break
          case 39: 
            socket.emit('rightKeyUp')
              break
      }
  }



    // Get players  
    socket.on("getPlayers", (players) => {
        ctx.fillStyle = 'black'
        ctx.fillRect(0, 0, canv.width, canv.height)
        myShip = null
        for (let i=0; i<players.length; i++) {
          if (players[i].id === socket.id) {
            myShip = players[i]
          }
        }

        moonx = 500 - myShip.x
        moony = 500 - myShip.y

        ctx.beginPath()
        ctx.arc(moonx, moony, 100, 0, 2 * Math.PI)
        ctx.fillStyle = 'lightgrey'
        ctx.fill()


        for (let i=0; i<players.length; i++) {
            ship = players[i]
            if (players[i].id === socket.id) {
              function drawMyShip(){
                var img = new Image()
                img.src = 'soyuz.png'
                function drawImage2(ctx, image, x, y, w, h, degrees){
                    ctx.save();
                    ctx.translate(x+w/2, y+h/2);
                    ctx.rotate(degrees);
                    ctx.translate(-x-w/2, -y-h/2);
                    ctx.drawImage(image, x, y, w, h);
                    ctx.restore();
                }
                drawImage2(ctx, img, 450, 450, 100, 100, -ship.a+7.85)
              }
              drawMyShip()
            }
            else {
              function drawShip(){
                var img = new Image()
                img.src = 'soyuz.png'
                function drawImage2(ctx, image, x, y, w, h, degrees){
                    ctx.save();
                    ctx.translate(x+w/2, y+h/2);
                    ctx.rotate(degrees);
                    ctx.translate(-x-w/2, -y-h/2);
                    ctx.drawImage(image, x, y, w, h);
                    ctx.restore();
                }
                drawImage2(ctx, img, ship.x-myShip.x+450, ship.y-myShip.y+450, 100, 100, -ship.a+7.85)
            }
            drawShip()
            }  
        }
    })

</script>

</html>